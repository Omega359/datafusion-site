---
layout: post
title: Apache DataFusion 48.0.0 Released
date: 2025-07-10
author: PMC
categories: [ release ]
---

<!--
{% comment %}
Licensed to the Apache Software Foundation (ASF) under one or more
contributor license agreements.  See the NOTICE file distributed with
this work for additional information regarding copyright ownership.
The ASF licenses this file to you under the Apache License, Version 2.0
(the "License"); you may not use this file except in compliance with
the License.  You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
{% endcomment %}
-->

<!-- see https://github.com/apache/datafusion/issues/16347 for details -->

We’re excited to announce the release of **Apache DataFusion 48.0.0**! This new version packs in a wide range of 
improvements and fixes. You can find the complete details in the full 
[changelog](https://github.com/apache/datafusion/blob/branch-48/dev/changelog/48.0.0.md). We’ll highlight the most
important changes below and guide you through upgrading.

## Breaking Changes

DataFusion 48.0.0 brings a few **breaking changes** that may require adjustments to your code as described in
the [Upgrade Guide](https://datafusion.apache.org/library-user-guide/upgrading.html). Here are the most notable ones:

- `Expr::Literal` has optional metadata: The `Expr::Literal` variant now includes optional metadata, which allows 
  for carrying through Arrow field metadata to support extension types and other uses. This means code such as
  ```Rust
  match expr {
  ...
  Expr::Literal(scalar) => ...
  ...
  }
  ```
  Should be updated to:
  ```Rust
  match expr {
  ...
  Expr::Literal(scalar, _metadata) => ...
  ...
  }
  ```
- `Expr::WindowFunction` is now Boxed: `Expr::WindowFunction` is now a `Box<WindowFunction>` instead of a `WindowFunction` 
  directly. This change was made to reduce the size of `Expr` and improve performance when planning queries 
  (see details on [#16207](https://github.com/apache/datafusion/pull/16207)).
- Processing `FieldRef` instead of `DataType` for UDFs: In order to support metadata handling and 
  extension types, UDFs are now switching to traits which use `FieldRef` rather than a `DataType`
  and nullability. This gives a single interface to both of these parameters and additionally allows access to 
  metadata fields, which can be used for extension types.
- Physical Expression return Field: To support the changes to UDFs processing metadata, the 
  `PhysicalExpr` trait now must specify a return `Field` based on the input schema. To upgrade structs which 
  implement `PhysicalExpr` you need to implement the `return_field` function. 
- `FileFormat::supports_filters_pushdown` replaced with `FileSource::try_pushdown_filters`: To support more general 
  filter pushdown, the `FileFormat::supports_filters_pushdown` was replaced with `FileSource::try_pushdown_filters`.
- `ParquetExec`, `AvroExec`, `CsvExec`, `JsonExec` removed: `ParquetExec`, `AvroExec`, `CsvExec`, and `JsonExec`
  were deprecated in DataFusion 46 and are removed in DataFusion 48.

## Performance Improvements

DataFusion 48.0.0 comes with some noteworthy performance enhancements:

- **Speed up optimize_projection:** In some cases a projection can be removed as it's unnecessary in a query. A series of PR's
  improved the logic surrounding the selection of unnecessary projections leading to more projections being able to be removed
  (PRs [#15787](https://github.com/apache/datafusion/pull/15787), [#15761](https://github.com/apache/datafusion/pull/15761),
  and [#15746](https://github.com/apache/datafusion/pull/15746) by [xudong963](https://github.com/xudong963)).
- **Accelerated the `ascii` function:** The `ascii` function was optimized to significantly improve its performance
  (PR [#16087](https://github.com/apache/datafusion/pull/16087) by [tlm365](https://github.com/tlm365)).
- **Speed up the `character_length` function:** The `character_length` function was optimized resulting is 
  [up to 3x](https://github.com/apache/datafusion/pull/15931#issuecomment-2848561984)
  performance improvement (PR [#15931](https://github.com/apache/datafusion/pull/15931)) by [Dandandan](https://github.com/Dandandan))
- **Constant aggregate window expression optimization:** For unbounded aggregate window functions the result is the 
  same for all rows within a partition. Therefore, DataFusion can avoid repeatedly computing the window bounds and 
  evaluating the function for each row, thus improving performance. For some queries this has been seen to 
  [improve performance by 5.6x](https://github.com/apache/datafusion/pull/16234#issuecomment-2935960865)
  (PR [#16234](https://github.com/apache/datafusion/pull/16234) by [suibianwanwank](https://github.com/suibianwanwank))

## Highlighted New Features

### datafusion-spark crate added

The DataFusion community has received many requests in the past to implement Spark-compatible functions. The current
builtin functions in DataFusion are most similar to Postgresql functions however the list of functions between Postgresql
and Apache Spark are expectedly not the same. There are even a few cases where the function name is the same
but signature and/or return type is different between the two systems.

In addition, one of the many uses of DataFusion is to enhance (e.g. [Apache DataFusion Comet](https://github.com/apache/datafusion-comet)) 
or replace (e.g. [Sail](https://github.com/lakehq/sail)) [Apache Spark](https://spark.apache.org/). To 
support the community requests and the use cases mentioned above a new `datafusion-spark` crate was added to 
DataFusion for spark-compatible builtin functions. 

To register all functions in datafusion-spark you can use:
```Rust
    // Create a new session context
    let mut ctx = SessionContext::new();
    // register all spark functions with the context
    datafusion_spark::register_all(&mut ctx)?;
    // run a query. Note the `sha2` function is now available which
    // has Spark semantics
    let df = ctx.sql("SELECT sha2('The input String', 256)").await?;
    ...
    ...
}
```
Or, to use an individual functions you can do:
```Rust
use datafusion_expr::{col, lit};
use datafusion_spark::expr_fn::sha2;
// Create the expression `sha2(my_data, 256)`
let expr = sha2(col("my_data"), lit(256));
...
```
Thanks to [shehabgamin](https://github.com/shehabgamin) for the initial PR [#15168](github.com/apache/datafusion/pull/15168) 
and many others for their help adding additional functions tracked in the 
[Complete datafusion-spark Spark Compatible Functions](https://github.com/apache/datafusion/issues/15914) epic.

### ORDER BY ALL sql support

Inspired by [DuckDB](https://duckdb.org/docs/stable/sql/query_syntax/orderby.html#order-by-all-examples) 
support for `ORDER BY ALL` was added to DataFusion in this release. This allows for easy ordering of all columns 
in a select query:

```sql
> set datafusion.sql_parser.dialect = 'DuckDB';
0 row(s) fetched.
> CREATE OR REPLACE TABLE addresses AS
    SELECT '123 Quack Blvd' AS address, 'DuckTown' AS city, '11111' AS zip
    UNION ALL
    SELECT '111 Duck Duck Goose Ln', 'DuckTown', '11111'
    UNION ALL
    SELECT '111 Duck Duck Goose Ln', 'Duck Town', '11111'
    UNION ALL
    SELECT '111 Duck Duck Goose Ln', 'Duck Town', '11111-0001';
0 row(s) fetched.
> SELECT * FROM addresses ORDER BY ALL;
+------------------------+-----------+------------+
| address                | city      | zip        |
+------------------------+-----------+------------+
| 111 Duck Duck Goose Ln | Duck Town | 11111      |
| 111 Duck Duck Goose Ln | Duck Town | 11111-0001 |
| 111 Duck Duck Goose Ln | DuckTown  | 11111      |
| 123 Quack Blvd         | DuckTown  | 11111      |
+------------------------+-----------+------------+
4 row(s) fetched.
```
Thanks to [PokIsemaine](https://github.com/PokIsemaine) for PR [#15772](https://github.com/apache/datafusion/pull/15772)

### AggregateUDF and WindowUDF added to FFI

This improvement allows for using user defined aggregate and user defined window functions across FFI boundaries. It 
is useful for enabling shared libraries to pass functions back and forth. This feature will unlock:
- Modules to provide DataFusion based FFI aggregates that can be reused in projects such as [datafusion-python](https://github.com/apache/datafusion-python)
- Allows for use across different DataFusion versions between the function provider and consumer

This completes the work to add support for all UDF types to DataFusion. Thanks to [timsaucer](https://github.com/timsaucer)
for PRs [#16261](https://github.com/apache/datafusion/pull/16261) and [#14775](https://github.com/apache/datafusion/pull/14775).

### Reduce size of Expr struct

A small code change to `Box` `WindowFunction`s expressions in the `Expr` struct had the fortunate side effect of improving
planning times from between 10% and 20%. Thanks to [hendrikmakait](https://github.com/hendrikmakait) for 
PR [#16207](https://github.com/apache/datafusion/pull/16207)

## Upgrade Guide and Changelog

Upgrading to 48.0.0 should be straightforward for most users, but do review
the [Upgrade Guide for DataFusion 48.0.0](https://datafusion.apache.org/library-user-guide/upgrading.html#datafusion-48-0-0) for detailed
steps and code changes. The upgrade guide covers the breaking changes mentioned above and provides code snippets to help with the
transition. For a comprehensive list of all changes, please refer to the [changelog](https://github.com/apache/datafusion/blob/branch-48/dev/changelog/48.0.0.md) 
for the 48.0.0 release. The changelog enumerates every merged PR in this release, including many smaller fixes and improvements 
that we couldn’t cover in this post.

## Get Involved

Apache DataFusion is an open-source project, and we welcome involvement from anyone interested. Now is a great time to
take 48.0.0 for a spin: try it out on your workloads, and let us know if you encounter any issues or have suggestions.
You can report bugs or request features on our GitHub issue tracker, or better yet, submit a pull request. Join our
community discussions – whether you have questions, want to share how you’re using DataFusion, or are looking to
contribute, we’d love to hear from you. A list of open issues suitable for beginners
is [here](https://github.com/apache/arrow-datafusion/issues?q=is%3Aissue+is%3Aopen+label%3A%22good+first+issue%22) and you
can find how to reach us on the [communication doc](https://datafusion.apache.org/contributor-guide/communication.html).

Happy querying!